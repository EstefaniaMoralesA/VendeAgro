/*
Deployment script for VendeAgro

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "VendeAgro"
:setvar DefaultFilePrefix "VendeAgro"
:setvar DefaultDataPath ""
:setvar DefaultLogPath ""

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET QUERY_STORE (OPERATION_MODE = READ_WRITE) 
            WITH ROLLBACK IMMEDIATE;
    END


GO
PRINT N'Creating [dbo].[Anuncio]...';


GO
CREATE TABLE [dbo].[Anuncio] (
    [id]             INT           IDENTITY (1, 1) NOT NULL,
    [titulo]         VARCHAR (30)  NOT NULL,
    [descripcion]    VARCHAR (250) NOT NULL,
    [precio]         FLOAT (53)    NOT NULL,
    [activo]         BIT           NOT NULL,
    [idUsuario]      INT           NULL,
    [idSubcategoria] INT           NULL,
    [idCiudad]       INT           NULL,
    [clicks]         INT           NULL,
    [vistas]         INT           NULL,
    [estado]         INT           NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Anuncio_Beneficio]...';


GO
CREATE TABLE [dbo].[Anuncio_Beneficio] (
    [id]          INT IDENTITY (1, 1) NOT NULL,
    [idAnuncio]   INT NOT NULL,
    [idBeneficio] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Anuncio_Paquete]...';


GO
CREATE TABLE [dbo].[Anuncio_Paquete] (
    [id]          INT          IDENTITY (1, 1) NOT NULL,
    [idAnuncio]   INT          NOT NULL,
    [idPaquete]   INT          NOT NULL,
    [fechaInicio] DATE         NOT NULL,
    [fechaFin]    DATE         NOT NULL,
    [activo]      BIT          NOT NULL,
    [folio]       VARCHAR (20) NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Banner]...';


GO
CREATE TABLE [dbo].[Banner] (
    [id]     INT           IDENTITY (1, 1) NOT NULL,
    [ruta]   VARCHAR (100) NOT NULL,
    [link]   VARCHAR (150) NOT NULL,
    [activo] BIT           NOT NULL,
    [tipo]   INT           NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Beneficio]...';


GO
CREATE TABLE [dbo].[Beneficio] (
    [id]          INT           IDENTITY (1, 1) NOT NULL,
    [descripcion] VARCHAR (250) NOT NULL,
    [precio]      FLOAT (53)    NOT NULL,
    [tipo]        INT           NOT NULL,
    [numero]      INT           NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Categoria]...';


GO
CREATE TABLE [dbo].[Categoria] (
    [id]     INT          IDENTITY (1, 1) NOT NULL,
    [nombre] VARCHAR (50) NOT NULL,
    [activo] BIT          NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Ciudad]...';


GO
CREATE TABLE [dbo].[Ciudad] (
    [id]       INT          IDENTITY (1, 1) NOT NULL,
    [nombre]   VARCHAR (30) NOT NULL,
    [idEstado] INT          NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Conekta_Paquete]...';


GO
CREATE TABLE [dbo].[Conekta_Paquete] (
    [id]              INT          IDENTITY (1, 1) NOT NULL,
    [idPaquete]       INT          NOT NULL,
    [idUsuario]       INT          NOT NULL,
    [idConekta]       INT          NOT NULL,
    [fechaRenovacion] DATE         NOT NULL,
    [folio]           VARCHAR (20) NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Estado]...';


GO
CREATE TABLE [dbo].[Estado] (
    [id]     INT          IDENTITY (1, 1) NOT NULL,
    [nombre] VARCHAR (30) NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Fotos_Anuncio]...';


GO
CREATE TABLE [dbo].[Fotos_Anuncio] (
    [id]        INT           IDENTITY (1, 1) NOT NULL,
    [ruta]      VARCHAR (100) NOT NULL,
    [idAnuncio] INT           NOT NULL,
    [principal] BIT           NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Metricas]...';


GO
CREATE TABLE [dbo].[Metricas] (
    [id]      INT  IDENTITY (1, 1) NOT NULL,
    [visitas] INT  NOT NULL,
    [fecha]   DATE NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Pago]...';


GO
CREATE TABLE [dbo].[Pago] (
    [id]             INT          IDENTITY (1, 1) NOT NULL,
    [idUsuario]      INT          NOT NULL,
    [tipoTarjeta]    INT          NOT NULL,
    [digitosTarjeta] INT          NOT NULL,
    [total]          FLOAT (53)   NOT NULL,
    [fecha]          DATE         NOT NULL,
    [tipo]           INT          NOT NULL,
    [Referencia]     VARCHAR (40) NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Pago_Concepto]...';


GO
CREATE TABLE [dbo].[Pago_Concepto] (
    [id]          INT IDENTITY (1, 1) NOT NULL,
    [idPago]      INT NOT NULL,
    [idPaquete]   INT NULL,
    [idBeneficio] INT NULL,
    [tipo]        BIT NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Paquete]...';


GO
CREATE TABLE [dbo].[Paquete] (
    [id]                INT           IDENTITY (1, 1) NOT NULL,
    [nombre]            VARCHAR (50)  NOT NULL,
    [meses]             INT           NOT NULL,
    [numeroAnuncios]    INT           NOT NULL,
    [precio]            FLOAT (53)    NOT NULL,
    [descripcion]       VARCHAR (200) NOT NULL,
    [paqueteBase]       BIT           NOT NULL,
    [fechaModificacion] DATE          NOT NULL,
    [activo]            BIT           NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Subcategoria]...';


GO
CREATE TABLE [dbo].[Subcategoria] (
    [id]          INT          IDENTITY (1, 1) NOT NULL,
    [nombre]      VARCHAR (50) NOT NULL,
    [activo]      BIT          NOT NULL,
    [idCategoria] INT          NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Usuario]...';


GO
CREATE TABLE [dbo].[Usuario] (
    [id]            INT          IDENTITY (1, 1) NOT NULL,
    [nombre]        VARCHAR (50) NOT NULL,
    [apellidos]     VARCHAR (80) NOT NULL,
    [telefono]      INT          NOT NULL,
    [email]         VARCHAR (50) NOT NULL,
    [password]      VARCHAR (40) NOT NULL,
    [confirmaEmail] BIT          NOT NULL,
    [tokenEmail]    VARCHAR (40) NOT NULL,
    [tokenSesion]   VARCHAR (40) NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Usuario_Administrador]...';


GO
CREATE TABLE [dbo].[Usuario_Administrador] (
    [id]            INT          IDENTITY (1, 1) NOT NULL,
    [nombre]        VARCHAR (30) NULL,
    [email]         VARCHAR (50) NOT NULL,
    [tokenEmail]    VARCHAR (40) NOT NULL,
    [tokenSesion]   VARCHAR (40) NOT NULL,
    [confirmaEmail] BIT          NOT NULL,
    [password]      VARCHAR (40) NOT NULL,
    [activo]        BIT          NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Usuario_Tarjeta]...';


GO
CREATE TABLE [dbo].[Usuario_Tarjeta] (
    [id]               INT          IDENTITY (1, 1) NOT NULL,
    [tipoTarjeta]      INT          NOT NULL,
    [digitosTarjeta]   INT          NOT NULL,
    [fechaVencimiento] DATE         NOT NULL,
    [tokenTarjeta]     VARCHAR (40) NOT NULL,
    [idUsuario]        INT          NOT NULL,
    [activo]           BIT          NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Videos_Anuncio]...';


GO
CREATE TABLE [dbo].[Videos_Anuncio] (
    [id]        INT           IDENTITY (1, 1) NOT NULL,
    [ruta]      VARCHAR (100) NOT NULL,
    [idAnuncio] INT           NOT NULL,
    PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating unnamed constraint on [dbo].[Anuncio]...';


GO
ALTER TABLE [dbo].[Anuncio] WITH NOCHECK
    ADD FOREIGN KEY ([idUsuario]) REFERENCES [dbo].[Usuario] ([id]) ON DELETE SET NULL ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Anuncio]...';


GO
ALTER TABLE [dbo].[Anuncio] WITH NOCHECK
    ADD FOREIGN KEY ([idSubcategoria]) REFERENCES [dbo].[Subcategoria] ([id]) ON DELETE SET NULL ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Anuncio]...';


GO
ALTER TABLE [dbo].[Anuncio] WITH NOCHECK
    ADD FOREIGN KEY ([idCiudad]) REFERENCES [dbo].[Ciudad] ([id]) ON DELETE SET NULL ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Anuncio_Beneficio]...';


GO
ALTER TABLE [dbo].[Anuncio_Beneficio] WITH NOCHECK
    ADD FOREIGN KEY ([idAnuncio]) REFERENCES [dbo].[Anuncio] ([id]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Anuncio_Beneficio]...';


GO
ALTER TABLE [dbo].[Anuncio_Beneficio] WITH NOCHECK
    ADD FOREIGN KEY ([idBeneficio]) REFERENCES [dbo].[Beneficio] ([id]) ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Anuncio_Paquete]...';


GO
ALTER TABLE [dbo].[Anuncio_Paquete] WITH NOCHECK
    ADD FOREIGN KEY ([idAnuncio]) REFERENCES [dbo].[Anuncio] ([id]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Anuncio_Paquete]...';


GO
ALTER TABLE [dbo].[Anuncio_Paquete] WITH NOCHECK
    ADD FOREIGN KEY ([idPaquete]) REFERENCES [dbo].[Paquete] ([id]) ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Ciudad]...';


GO
ALTER TABLE [dbo].[Ciudad] WITH NOCHECK
    ADD FOREIGN KEY ([idEstado]) REFERENCES [dbo].[Estado] ([id]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Conekta_Paquete]...';


GO
ALTER TABLE [dbo].[Conekta_Paquete] WITH NOCHECK
    ADD FOREIGN KEY ([idPaquete]) REFERENCES [dbo].[Paquete] ([id]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Conekta_Paquete]...';


GO
ALTER TABLE [dbo].[Conekta_Paquete] WITH NOCHECK
    ADD FOREIGN KEY ([idUsuario]) REFERENCES [dbo].[Usuario] ([id]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Fotos_Anuncio]...';


GO
ALTER TABLE [dbo].[Fotos_Anuncio] WITH NOCHECK
    ADD FOREIGN KEY ([idAnuncio]) REFERENCES [dbo].[Anuncio] ([id]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Pago]...';


GO
ALTER TABLE [dbo].[Pago] WITH NOCHECK
    ADD FOREIGN KEY ([idUsuario]) REFERENCES [dbo].[Usuario] ([id]) ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Pago_Concepto]...';


GO
ALTER TABLE [dbo].[Pago_Concepto] WITH NOCHECK
    ADD FOREIGN KEY ([idPago]) REFERENCES [dbo].[Pago] ([id]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Pago_Concepto]...';


GO
ALTER TABLE [dbo].[Pago_Concepto] WITH NOCHECK
    ADD FOREIGN KEY ([idPaquete]) REFERENCES [dbo].[Paquete] ([id]) ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Pago_Concepto]...';


GO
ALTER TABLE [dbo].[Pago_Concepto] WITH NOCHECK
    ADD FOREIGN KEY ([idBeneficio]) REFERENCES [dbo].[Beneficio] ([id]) ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Subcategoria]...';


GO
ALTER TABLE [dbo].[Subcategoria] WITH NOCHECK
    ADD FOREIGN KEY ([idCategoria]) REFERENCES [dbo].[Categoria] ([id]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Usuario_Tarjeta]...';


GO
ALTER TABLE [dbo].[Usuario_Tarjeta] WITH NOCHECK
    ADD FOREIGN KEY ([idUsuario]) REFERENCES [dbo].[Usuario] ([id]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating unnamed constraint on [dbo].[Videos_Anuncio]...';


GO
ALTER TABLE [dbo].[Videos_Anuncio] WITH NOCHECK
    ADD FOREIGN KEY ([idAnuncio]) REFERENCES [dbo].[Anuncio] ([id]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
